# gosynctasks configuration file
# See https://github.com/DeepReef11/gosynctasks for documentation
#
# Configuration Priority:
# 1. --config flag (explicit path)
# 2. ./gosynctasks/config.yaml (project-local config)
# 3. ~/.config/gosynctasks/config.yaml (user config)

# =============================================================================
# BACKENDS - Configure multiple storage backends
# =============================================================================

backends:
  # SQLite Backend - Local database storage
  # Best for: Offline-first workflow, fast operations, sync with remote
  sqlite:
    type: sqlite
    enabled: false
    db_path: ""  # Empty = XDG-compliant default: ~/.local/share/gosynctasks/tasks.db
                 # Or specify custom path: "/path/to/tasks.db"

  # Nextcloud Backend - CalDAV/CardDAV server
  # Best for: Multi-device sync, web interface, shared calendars
  #
  # CREDENTIAL STORAGE (Priority: Keyring > Environment Variables > Config URL)
  #
  # Option 1: System Keyring (RECOMMENDED - Most Secure)
  # Store credentials in OS keyring (macOS Keychain, Windows Credential Manager, Linux Secret Service)
  nextcloud-prod:
    type: nextcloud
    enabled: true
    host: "nextcloud.example.com"  # Hostname without credentials
    username: "myuser"             # Username for keyring lookup
    # Password stored in keyring - set with:
    #   gosynctasks credentials set nextcloud myuser --prompt

    # Option 2: Environment Variables (Good for CI/CD)
    # Set these environment variables instead of host/username/url:
    #   export GOSYNCTASKS_NEXTCLOUD_HOST=nextcloud.example.com
    #   export GOSYNCTASKS_NEXTCLOUD_USERNAME=myuser
    #   export GOSYNCTASKS_NEXTCLOUD_PASSWORD=secret

    # Option 3: Config URL (LEGACY - Not Recommended)
    # Credentials in plain text - less secure:
    #   url: "nextcloud://username:password@nextcloud.example.com"

    # SSL/TLS Settings
    insecure_skip_verify: false  # WARNING: Only use for self-signed certs in development
    suppress_ssl_warning: false  # Suppress warning when insecure_skip_verify is true

    # HTTP Settings (for local testing only)
    allow_http: false            # Allow insecure HTTP (DO NOT use in production)
    suppress_http_warning: false # Suppress HTTP warning when allow_http is true

  # Git Backend - Markdown files in git repositories
  # Best for: Developer workflow, plain text, version control
  git:
    type: git
    enabled: false
    file: "TODO.md"              # Primary file to use
    auto_detect: true            # Auto-detect git repos with marker comment
    fallback_files:              # Try these if primary file doesn't exist
      - "todo.md"
      - ".gosynctasks.md"
    auto_commit: false           # Auto-commit changes (optional)

  # File Backend - Simple file-based storage (experimental)
  # Best for: Simple setups, no dependencies
  file:
    type: file
    enabled: false
    url: "file://~/.config/gosynctasks/tasks.json"

  # Todoist Backend - Cloud task management service
  # Best for: Cross-platform sync, mobile apps, collaboration
  #
  # CREDENTIAL STORAGE (Priority: Keyring > Environment Variables > Config)
  #
  # Option 1: System Keyring (RECOMMENDED - Most Secure)
  # Store API token in OS keyring
  todoist:
    type: todoist
    enabled: false
    username: "token"  # Username hint for keyring (use "token" for API keys)
    # API token stored in keyring - set with:
    #   gosynctasks credentials set todoist token --prompt
    # Enter your API token when prompted (get from https://todoist.com/app/settings/integrations)

    # Option 2: Environment Variables (Good for CI/CD)
    # Set these environment variables instead:
    #   export GOSYNCTASKS_TODOIST_PASSWORD="your-api-token-here"
    # Config can be minimal (just type and enabled)

    # Option 3: Config File (Simple but less secure)
    # Store API token directly in config (plain text)
    #   api_token: "your-todoist-api-token-here"
    # Get your token from: https://todoist.com/app/settings/integrations

# =============================================================================
# BACKEND SELECTION
# =============================================================================

# Default backend for CLI operations
# NOTE: When sync is enabled, the local_backend is automatically used for operations
#       and the backend_priority is only used when sync is disabled
default_backend: nextcloud-prod

# Enable automatic backend detection
auto_detect_backend: false

# Priority order for auto-detection (first match wins)
# NOTE: When sync is enabled, you don't need to include the local backend here
#       The sync configuration will automatically use the local_backend
backend_priority:
  - nextcloud-prod  # Use Nextcloud when sync is disabled
  - git        # Check for git repo with TODO.md first

# =============================================================================
# SYNCHRONIZATION - Bidirectional sync between local and remote
# =============================================================================

# Example Configuration #1: Nextcloud-only (no sync, direct remote access)
# sync:
#   enabled: false
# backend_priority:
#   - nextcloud

# Example Configuration #2: SQLite + Nextcloud with Auto-Sync (RECOMMENDED)
# This gives you fast local operations with automatic background sync
# When sync is enabled, all CLI operations automatically use the local_backend (sqlite)
# and sync to the remote_backend (nextcloud) in the background
sync:
  enabled: false              # Set to true to enable sync
  auto_sync: false            # Set to true to enable automatic background sync
                              # When true: write operations (add/update/complete/delete)
                              # return immediately after writing to sqlite, then sync to
                              # remote in a background goroutine (daemon-like behavior)

  # Backend Configuration
  # When sync.enabled = true, the CLI automatically uses local_backend for operations
  # You don't need to include local_backend in backend_priority
  local_backend: sqlite       # Local backend (must be SQLite type)
  remote_backend: nextcloud-prod   # Remote backend (nextcloud, git, or file)

  # Sync Behavior
  sync_interval: 5            # Minutes before local data is considered stale
                              # When listing tasks:
                              #   - If last sync > sync_interval: trigger pull in background
                              #   - If last sync < sync_interval: use cached data (fast!)
                              # Set to 0 to always use cache (manual sync only)

  # Conflict Resolution
  conflict_resolution: server_wins  # How to handle sync conflicts:
                                    # - server_wins: Remote overrides local (safest, recommended)
                                    # - local_wins: Local overrides remote (use with caution)
                                    # - merge: Intelligently merge non-conflicting fields
                                    # - keep_both: Create duplicate with " (local copy)" suffix

  # Offline Mode
  offline_mode: auto          # Offline detection mode:
                              # - auto: Automatically detect online/offline (recommended)
                              # - online: Assume always online (fail if offline)
                              # - offline: Assume always offline (queue all operations)

# Example Configuration #3: SQLite + Git with Auto-Sync
# sync:
#   enabled: true
#   auto_sync: true
#   local_backend: sqlite
#   remote_backend: git
#   sync_interval: 1           # Pull more frequently for git
#   conflict_resolution: local_wins  # Local takes precedence for developer workflow
#   offline_mode: auto

# =============================================================================
# UI & DISPLAY
# =============================================================================

canWriteConfig: true          # Allow saving config changes
ui: cli                       # UI mode (currently only "cli" supported)
date_format: "2006-01-02"     # Go time format (YYYY-MM-DD)

# =============================================================================
# USAGE EXAMPLES
# =============================================================================

# Basic Operations:
#   gosynctasks                              # Interactive list selection
#   gosynctasks MyList                       # Show tasks
#   gosynctasks MyList add "Task"            # Add task
#   gosynctasks MyList update "task" -s DONE # Update status
#   gosynctasks MyList complete "task"       # Mark done
#
# With Auto-Sync Enabled:
#   - All write operations (add/update/delete) sync in background
#   - Read operations check staleness and pull if needed
#   - Operations return immediately (local-first, no waiting!)
#
# Manual Sync:
#   gosynctasks sync                         # Full bidirectional sync
#   gosynctasks sync status                  # Check sync status
#   gosynctasks sync queue                   # View pending operations
#
# Backend Selection:
#   gosynctasks --backend sqlite MyList      # Use specific backend
#   gosynctasks --list-backends              # Show all backends
#   gosynctasks --detect-backend             # Show auto-detected backends
