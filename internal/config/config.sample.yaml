# gosynctasks configuration file
# See https://github.com/DeepReef11/gosynctasks for documentation
#
# Configuration Priority:
# 1. --config flag (explicit path)
# 2. ./gosynctasks/config.yaml (project-local config)
# 3. ~/.config/gosynctasks/config.yaml (user config)

# =============================================================================
# BACKENDS - Configure multiple storage backends
# =============================================================================

backends:
  # SQLite Backend - Local database storage
  # Best for: Offline-first workflow, fast operations, sync with remote
  sqlite:
    type: sqlite
    enabled: false
    db_path: ""  # Empty = XDG-compliant default: ~/.local/share/gosynctasks/tasks.db
                 # Or specify custom path: "/path/to/tasks.db"

    # Per-Backend Sync Configuration (NEW)
    # Configure sync relationship with a remote backend
    sync:
      enabled: false              # Enable sync for this backend
      remote_backend: nextcloud-prod  # Name of remote backend to sync with
      conflict_resolution: server_wins  # server_wins, local_wins, merge, keep_both
      auto_sync: false            # Auto-sync after write operations
      sync_interval: 5            # Minutes between auto-syncs (0=manual only)
      offline_mode: auto          # auto, online, offline

  # Nextcloud Backend - CalDAV/CardDAV server
  # Best for: Multi-device sync, web interface, shared calendars
  #
  # CREDENTIAL STORAGE (Priority: Keyring > Environment Variables > Config URL)
  #
  # Option 1: System Keyring (RECOMMENDED - Most Secure)
  # Store credentials in OS keyring (macOS Keychain, Windows Credential Manager, Linux Secret Service)
  nextcloud-prod:
    type: nextcloud
    enabled: true
    host: "nextcloud.example.com"  # Hostname without credentials
    username: "myuser"             # Username for keyring lookup
    # Password stored in keyring - set with:
    #   gosynctasks credentials set nextcloud myuser --prompt

    # Option 2: Environment Variables (Good for CI/CD)
    # Set these environment variables instead of host/username/url:
    #   export GOSYNCTASKS_NEXTCLOUD_HOST=nextcloud.example.com
    #   export GOSYNCTASKS_NEXTCLOUD_USERNAME=myuser
    #   export GOSYNCTASKS_NEXTCLOUD_PASSWORD=secret

    # Option 3: Config URL (LEGACY - Not Recommended)
    # Credentials in plain text - less secure:
    #   url: "nextcloud://username:password@nextcloud.example.com"

    # SSL/TLS Settings
    insecure_skip_verify: false  # WARNING: Only use for self-signed certs in development
    suppress_ssl_warning: false  # Suppress warning when insecure_skip_verify is true

    # HTTP Settings (for local testing only)
    allow_http: false            # Allow insecure HTTP (DO NOT use in production)
    suppress_http_warning: false # Suppress HTTP warning when allow_http is true

  # Git Backend - Markdown files in git repositories
  # Best for: Developer workflow, plain text, version control
  git:
    type: git
    enabled: false
    file: "TODO.md"              # Primary file to use
    auto_detect: true            # Auto-detect git repos with marker comment
    fallback_files:              # Try these if primary file doesn't exist
      - "todo.md"
      - ".gosynctasks.md"
    auto_commit: false           # Auto-commit changes (optional)

  # File Backend - Simple file-based storage (experimental)
  # Best for: Simple setups, no dependencies
  file:
    type: file
    enabled: false
    url: "file://~/.config/gosynctasks/tasks.json"

  # Todoist Backend - Cloud task management service
  # Best for: Cross-platform sync, mobile apps, collaboration
  #
  # CREDENTIAL STORAGE (Priority: Keyring > Environment Variables > Config)
  #
  # Option 1: System Keyring (RECOMMENDED - Most Secure)
  # Store API token in OS keyring
  todoist:
    type: todoist
    enabled: false
    username: "token"  # Username hint for keyring (use "token" for API keys)
    # API token stored in keyring - set with:
    #   gosynctasks credentials set todoist token --prompt
    # Enter your API token when prompted (get from https://todoist.com/app/settings/integrations)

    # Option 2: Environment Variables (Good for CI/CD)
    # Set these environment variables instead:
    #   export GOSYNCTASKS_TODOIST_PASSWORD="your-api-token-here"
    # Config can be minimal (just type and enabled)

    # Option 3: Config File (Simple but less secure)
    # Store API token directly in config (plain text)
    #   api_token: "your-todoist-api-token-here"
    # Get your token from: https://todoist.com/app/settings/integrations

# =============================================================================
# BACKEND SELECTION
# =============================================================================

# Default backend for CLI operations
# NOTE: When sync is enabled, the local_backend is automatically used for operations
#       and the backend_priority is only used when sync is disabled
default_backend: nextcloud-prod

# Enable automatic backend detection
auto_detect_backend: false

# Priority order for auto-detection (first match wins)
# NOTE: When sync is enabled, you don't need to include the local backend here
#       The sync configuration will automatically use the local_backend
backend_priority:
  - nextcloud-prod  # Use Nextcloud when sync is disabled
  - git        # Check for git repo with TODO.md first

# =============================================================================
# SYNCHRONIZATION - Bidirectional sync between local and remote
# =============================================================================

# NEW APPROACH (RECOMMENDED): Per-Backend Sync Configuration
# Configure sync directly on each backend (see sqlite.sync above)
# This allows multiple backends to have their own sync relationships
#
# Example: Two SQLite backends syncing with different remote backends
# backends:
#   work-cache:
#     type: sqlite
#     enabled: true
#     db_path: ~/.local/share/gosynctasks/work.db
#     sync:
#       enabled: true
#       remote_backend: nextcloud-work
#       conflict_resolution: server_wins
#       auto_sync: true
#
#   personal-cache:
#     type: sqlite
#     enabled: true
#     db_path: ~/.local/share/gosynctasks/personal.db
#     sync:
#       enabled: true
#       remote_backend: nextcloud-personal
#       conflict_resolution: server_wins
#       auto_sync: true

# LEGACY APPROACH (Backward Compatible): Global Sync Configuration
# This is the old way - still supported but deprecated
# Will be automatically migrated to per-backend sync on next config reload
sync:
  enabled: false              # Set to true to enable sync (DEPRECATED)
  auto_sync: false            # Auto-sync after write operations (DEPRECATED)
  local_backend: sqlite       # Local backend (DEPRECATED - use per-backend sync)
  remote_backend: nextcloud-prod   # Remote backend (DEPRECATED)
  sync_interval: 5            # Minutes between auto-syncs (DEPRECATED)
  conflict_resolution: server_wins  # Conflict resolution strategy (DEPRECATED)
  offline_mode: auto          # Offline detection mode (DEPRECATED)

# Migration Note:
# If you have a global sync: configuration, it will be automatically converted
# to per-backend sync configuration. The global sync: section can then be removed.

# =============================================================================
# UI & DISPLAY
# =============================================================================

canWriteConfig: true          # Allow saving config changes
ui: cli                       # UI mode (currently only "cli" supported)
date_format: "2006-01-02"     # Go time format (YYYY-MM-DD)

# =============================================================================
# USAGE EXAMPLES
# =============================================================================

# Basic Operations:
#   gosynctasks                              # Interactive list selection
#   gosynctasks MyList                       # Show tasks
#   gosynctasks MyList add "Task"            # Add task
#   gosynctasks MyList update "task" -s DONE # Update status
#   gosynctasks MyList complete "task"       # Mark done
#
# With Auto-Sync Enabled:
#   - All write operations (add/update/delete) sync in background
#   - Read operations check staleness and pull if needed
#   - Operations return immediately (local-first, no waiting!)
#
# Manual Sync:
#   gosynctasks sync                         # Full bidirectional sync
#   gosynctasks sync status                  # Check sync status
#   gosynctasks sync queue                   # View pending operations
#
# Backend Selection:
#   gosynctasks --backend sqlite MyList      # Use specific backend
#   gosynctasks --list-backends              # Show all backends
#   gosynctasks --detect-backend             # Show auto-detected backends
